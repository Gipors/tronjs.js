(function(a){if(typeof exports=="object"||typeof exports==="function"&&typeof module=="object"){module.exports=a()}else{if(typeof define=="function"&&define.amd){return define([],a)}else{window.iPress=a()}}})(function(){var c=new Class(function(){this.error=0;this.iControler=new a();this.iEvent=new b();if(typeof this.PressURL==="function"){this.token=this.PressURL(this.getURL())}else{this.token=this._PressURL(this.getURL())}});c.add("errors",{"0":"正常","404":"找不到页面地址","500":"服务端出错"});c.add("getURL",function(){var d=http.emit(Request.QueryString);if(d.length>0){return d[0]}else{return"page:home.html"}});c.add("setURL",function(h,d,k){var f="?"+h+":";if(d){f+="@"+d}var e=[],j="";if(k){for(var g in k){e.push(g+"("+k[g]+")")}}if(e.length>0){j="-"+e.join("-")}f+=j+".html";return f});c.add("_PressURL",function(d){var e={controler:"page",searchers:{},views:"home"};var f=d.split(":");if(f.length>1){e.controler=f[0];f=f[1].split(".");if(f.length>1){f=f[0].split("-");f.forEach(function(g){if(/^\@/.test(g)){e.views=g.replace(/^\@/,"")}else{if(/(\w+)(\(([^\)]+)\))?/.test(g)){var h=/(\w+)(\(([^\)]+)\))?/.exec(g);if(h&&h[1]){e.searchers[h[1]]=h[3]||""}}}})}}return e});c.add("render",function(){var e=this.token;var h=this.iControler.get(e.controler,e.views);var g=this;var d=this.iEvent.get(e.controler);if(!d){return}var f=null;if(h[1]){fs(h[1]).exist().then(function(){var j=require(h[1]),i=function(){var k={};http.emit(Request.Form,function(l){var m=http.emit(Request.Form(l));k[l]=m&&m.length>1?m:m[0]});return k};f=new j(e.searchers,i)})}fs(h[0]).exist().fail(function(){g.error=404}).then(function(){if(f){include(h[0],f)}else{include(h[0])}}).stop()});var a=new Class(function(){this.map={}});a.add("set",function(l,d,h,g){if(!d&&readVariableType(l,"string")){var k=require(l);for(var f in k){for(var e in k[f]){this.set(f,e,k[f][e][0],k[f][e][1])}}}else{if(!this.map[l]){this.map[l]={}}if(!this.map[l][d]){if(g){this.map[l][d]=[h,g]}else{this.map[l][d]=[h]}}}});a.add("get",function(e,d){if(this.map[e]&&this.map[e][d]){return this.map[e][d]}else{this.error=404}});var b=new Class(function(){this.map={}});b.add("set",function(d,e){if(!this.map[d]){this.map[d]=[]}if(typeof e==="function"){this.map[d].push(e)}});b.add("get",function(e){var d=true;if(this.map[e]){this.map[e].forEach(function(g){var f=g();if(f===false){d=false}})}return d});return c});